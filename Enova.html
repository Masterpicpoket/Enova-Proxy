<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Enova - Firebase Proxy</title>
<style>
body {
  font-family:'Segoe UI',sans-serif;
  margin:0; padding:0;
  display:flex; justify-content:center; align-items:center;
  min-height:100vh;
  background-color:#121212;
  color:#f5f5f5;
  transition: background 0.3s,color 0.3s;
  position:relative;
}
body.light { background-color:#f5f5f5; color:#121212; }

#connection-status {
  position:absolute;
  top:10px;
  right:10px;
  display:flex;
  align-items:center;
  gap:8px;
  font-size:0.9em;
}
#client-ip {
  position:absolute;
  top:10px; left:10px;
  font-size:0.9em;
}

.status-dot { width:12px; height:12px; border-radius:50%; position:relative; }
.red { background-color:red; }
.orange { background-color:orange; }
.green { background-color:green; }
.pulse::before {
  content:'';
  position:absolute;
  left:50%; top:50%;
  width:12px; height:12px;
  border-radius:50%;
  transform:translate(-50%,-50%) scale(1);
  opacity:1;
  animation:pulseEffect 1s ease-out infinite;
}
@keyframes pulseEffect { 0% {transform:translate(-50%,-50%) scale(1);opacity:1;} 50% {transform:translate(-50%,-50%) scale(2);opacity:0.5;} 100% {transform:translate(-50%,-50%) scale(3);opacity:0;} }

.container {
  text-align:center;
  width:90%;
  max-width:600px;
  padding:40px;
  border-radius:15px;
  background-color:rgba(0,0,0,0.6);
  backdrop-filter:blur(10px);
  transition: background 0.3s;
}
body.light .container { background-color:rgba(255,255,255,0.8); }

img.icon { width:80px; margin-bottom:20px; }
h1 { font-size:2.5em; margin-bottom:10px; }
h2 { font-weight:400; font-size:1.2em; color:#aaa; margin-bottom:20px; }
body.light h2 { color:#555; }

input { width:100%; padding:15px 20px; font-size:1em; border-radius:50px; border:none; outline:none; background-color:#1f1f1f; color:#f5f5f5; transition: background 0.3s,color 0.3s; margin-bottom:10px; }
body.light input { background-color:#e0e0e0; color:#121212; }

button { margin-top:10px; padding:10px 25px; border:none; border-radius:50px; cursor:pointer; font-size:0.9em; background-color:#333; color:#fff; transition: background 0.3s,color 0.3s; }
body.light button { background-color:#ddd; color:#121212; }

#loading { display:none; margin:20px auto; border:5px solid rgba(255,255,255,0.3); border-top:5px solid #f5f5f5; border-radius:50%; width:40px; height:40px; animation:spin 1s linear infinite; }
body.light #loading { border-top:5px solid #121212; border-color: rgba(0,0,0,0.2) rgba(0,0,0,0.2) rgba(0,0,0,0.2) #121212; }

@keyframes spin { 0% { transform:rotate(0deg);} 100% { transform:rotate(360deg);} }

pre#output { margin-top:20px; max-height:300px; overflow-y:auto; text-align:left; padding:15px; border-radius:10px; background-color:rgba(0,0,0,0.5); white-space:pre-wrap; word-wrap:break-word; font-size:0.9em; }
body.light pre#output { background-color:rgba(255,255,255,0.6); }
</style>
</head>
<body>
<div id="client-ip">IP: loading...</div>
<div id="connection-status">
  <div class="status-dot red" id="status-dot"></div>
  <span id="status-text">No Connection</span>
</div>

<div class="container">
  <img src="icon.png" alt="Enova Icon" class="icon">
  <h1>Enova</h1>
  <h2>Undetectable Searching</h2>

  <div>
    <input type="text" id="url" placeholder="Enter URL to fetch">
    <button onclick="sendRequest()">Fetch</button>
  </div>

  <div id="loading"></div>
  <pre id="output"></pre>

  <button onclick="toggleMode()">Toggle Dark/Light Mode</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
import { getDatabase, ref, set, onValue, get } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js";
import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyDJR1KukEJs3e5VdJ63i0p743irSunGQ7w",
  authDomain: "enova-backend.firebaseapp.com",
  databaseURL: "https://enova-backend-default-rtdb.firebaseio.com",
  projectId: "enova-backend",
  storageBucket: "enova-backend.firebasestorage.app",
  messagingSenderId: "131885379083",
  appId: "1:131885379083:web:27e3a12e30052de99e610e",
  measurementId: "G-0PN85SG6FE"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);
signInAnonymously(auth).catch(err => console.error(err));

let status='no';
function updateStatus(newStatus){
  status=newStatus;
  const dot=document.getElementById('status-dot');
  const text=document.getElementById('status-text');
  dot.classList.remove('red','orange','green','pulse');
  if(status==='no'){dot.classList.add('red'); text.textContent="No Connection";}
  else if(status==='pending'){dot.classList.add('orange','pulse'); text.textContent="Pending...";}
  else if(status==='connected'){dot.classList.add('green','pulse'); text.textContent="Connected";}
}
updateStatus('no');

// Show client IP
fetch("https://api.ipify.org?format=json")
  .then(res=>res.json())
  .then(data=>{document.getElementById('client-ip').textContent="IP: "+data.ip;})
  .catch(()=>{document.getElementById('client-ip').textContent="IP: unknown";});

// Test Firebase connection
async function testFirebase(){
  try{
    const pingRef = ref(db,'ping_test');
    await set(pingRef,{time:Date.now()});
    const snapshot = await get(pingRef);
    if(snapshot.exists()){updateStatus('connected');}
    else{updateStatus('no');}
  }catch(e){console.error(e); updateStatus('no');}
}
testFirebase();

function sendRequest(){
  const url = document.getElementById('url').value.trim();
  if(!url) return alert("Enter a URL!");

  updateStatus('pending');
  const id = Date.now().toString();
  const reqRef = ref(db,"requests/"+id);
  set(reqRef,{url,status:"pending"});

  document.getElementById('loading').style.display='block';
  document.getElementById('output').textContent='';

  onValue(reqRef,snapshot=>{
    const data = snapshot.val();
    if(!data) return;
    if(data.status==='done'){
      document.getElementById('loading').style.display='none';
      document.getElementById('output').textContent=data.html;
      updateStatus('connected');
    } else if(data.status==='error'){
      document.getElementById('loading').style.display='none';
      document.getElementById('output').textContent="Error: "+data.html;
      updateStatus('connected');
    }
  });
}


// Load saved mode
if(localStorage.getItem('enova-mode')==='light'){
  document.body.classList.add('light');
}
</script>
</body>
</html>
